var P=Object.defineProperty,x=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var $=(e,l,o)=>l in e?P(e,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[l]=o,B=(e,l)=>{for(var o in l||(l={}))R.call(l,o)&&$(e,o,l[o]);if(A)for(var o of A(l))q.call(l,o)&&$(e,o,l[o]);return e},I=(e,l)=>x(e,V(l));var c=(e,l,o)=>new Promise((p,F)=>{var _=i=>{try{b(o.next(i))}catch(h){F(h)}},w=i=>{try{b(o.throw(i))}catch(h){F(h)}},b=i=>i.done?p(i.value):Promise.resolve(i.value).then(_,w);b((o=o.apply(e,l)).next())});import{D as n,bs as N,bu as O,b as M,j as z,C as G,o as T,e as W,E as u,Q as s,br as f,h as d,t as C,G as g,aK as j,f as K,I as L,bw as D,a7 as v,bV as Q,bW as U,bh as H}from"./vendor.1de287a7.js";/* empty css              */import{D as J}from"./dynamic-table.96d276c6.js";/* empty css               */import{u as X}from"./useFormModal.67d087a2.js";import{y as r,O as m}from"./index.57f23076.js";const Y=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},Z=e=>{switch(e){case 0:return"\u505C\u6B62";case 1:return"\u8FD0\u884C"}},ee=[{title:"\u4EFB\u52A1\u540D\u79F0",dataIndex:"name",width:240},{title:"\u72B6\u6001",width:120,dataIndex:"status",align:"center",bodyCell:({record:e})=>n(N,{status:e.status===1?"processing":"default",color:Y(e.status),text:Z(e.status)},null)},{title:"\u7C7B\u578B",width:100,align:"center",dataIndex:"type",bodyCell:({record:e})=>n(O,{color:"processing"},{default:()=>[e.type===1?"Interval":"Cron"]})},{title:"\u8C03\u7528\u670D\u52A1",dataIndex:"service",hideInSearch:!0,align:"center",width:350},{title:"\u6267\u884C\u53C2\u6570",dataIndex:"data",align:"center",hideInSearch:!0,width:450},{title:"\u5907\u6CE8",width:250,align:"center",dataIndex:"remark"}],te=[{field:"type",component:"RadioGroup",label:"\u540D\u79F0",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"\u65F6\u95F4\u95F4\u9694",value:1}]}},{field:"name",component:"Input",label:"\u4EFB\u52A1\u540D\u79F0",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"\u670D\u52A1\u8DEF\u5F84",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"\u8BF7\u8F93\u5165\u8C03\u7528\u670D\u52A1\u7684\u8DEF\u5F84"}},{field:"data",component:"Input",label:"\u4EFB\u52A1\u53C2\u6570",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u53C2\u6570\uFF08\u53EF\u4E0D\u586B\uFF09"}},{field:"limit",component:"InputNumber",label:"\u6267\u884C\u6B21\u6570",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>e.type===0,componentProps:{placeholder:"\u8BF7\u8F93\u5165Cron\u8868\u8FBE\u5F0F"}},{field:"every",component:"InputNumber",label:"\u6267\u884C\u95F4\u9694",defaultValue:6e4,vIf:({formModel:e})=>e.type===1,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"\u5F00\u59CB\u65F6\u95F4",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"\u7ED3\u675F\u65F6\u95F4",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"status",component:"RadioGroup",defaultValue:1,label:"\u72B6\u6001",componentProps:{options:[{label:"\u8FD0\u884C",value:1},{label:"\u505C\u6B62",value:0}]}}];function ue(e){return r({url:m.page,method:"get",params:e})}function ae(e){return r({url:m.info,method:"get",params:e})}function se(e){return r({url:m.add,method:"post",data:e},{successMsg:"\u6DFB\u52A0\u6210\u529F"})}function ne(e){return r({url:m.delete,method:"post",data:e})}function le(e){return r({url:m.update,method:"post",data:e},{successMsg:"\u4FEE\u6539\u6210\u529F"})}function oe(e){return r({url:m.once,method:"post",data:e})}function ie(e){return r({url:m.start,method:"post",data:e})}function de(e){return r({url:m.stop,method:"post",data:e})}const re=d(" \u65B0\u589E "),me=d("\u79D2 \u5206 \u5C0F\u65F6 \u65E5\u671F \u6708\u4EFD \u661F\u671F \u5E74(\u53EF\u9009)"),pe=d("\u4EC5\u4E00\u6B21 "),ce=d("\u8FD0\u884C "),fe=d("\u505C\u6B62 "),Fe={name:"SystemScheduleTask"},Te=M(I(B({},Fe),{setup(e){const l=z(),[o]=X(),p=()=>{var t;return(t=l.value)==null?void 0:t.refreshTable()},F=t=>c(this,null,function*(){var k;const[E]=yield o({modalProps:{title:`${t.id?"\u7F16\u8F91":"\u65B0\u589E"}\u4EFB\u52A1`,width:640,onFinish:a=>c(this,null,function*(){const y=I(B({},a),{id:t.id});yield(t.id?le:se)(y),p()})},formSchema:{labelWidth:100,layout:"vertical",schemas:te}});if(t.id){const a=yield ae({id:t.id});(k=E.value)==null||k.setFieldsValue(B(B({},t),a))}}),_=t=>c(this,null,function*(){yield ne({id:t}),p()}),w=t=>c(this,null,function*(){yield oe({id:t.id}),p()}),b=t=>c(this,null,function*(){yield ie({id:t.id}),p()}),i=t=>c(this,null,function*(){yield de({id:t.id}),p()}),h=t=>!t.startTime&&!t.endTime?"\u65E0\u65F6\u6BB5\u9650\u5236":!t.startTime&&t.endTime?`\u65E0\u5F00\u59CB\u65F6\u95F4\u9650\u5236 - ${t.endTime}`:t.startTime&&!t.endTime?`${t.startTime} - \u957F\u671F\u6709\u6548`:`${t.startTime} - ${t.endTime}`,S=[...ee,{title:"\u64CD\u4F5C",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:t})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.task.update",effect:"disable"},onClick:()=>F(t)},{label:"\u5220\u9664",auth:"sys.task.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>_(t.id)}}]}];return(t,E)=>{const k=G("a-button");return T(),W("div",null,[n(s(J),{ref_key:"dynamicTableRef",ref:l,"row-key":"id","header-title":"\u5B9A\u65F6\u4EFB\u52A1",search:!1,"data-request":s(ue),columns:S,scroll:{x:2e3},bordered:"",size:"small"},{toolbar:u(()=>[n(k,{type:"primary",disabled:!t.$auth("sys.task.add"),onClick:E[0]||(E[0]=a=>F({}))},{default:u(()=>[re]),_:1},8,["disabled"])]),expandedRowRender:u(({record:a})=>[n(s(f),{column:1},{default:u(()=>[n(s(f).Item,{label:"\u4EFB\u52A1\u7F16\u53F7"},{default:u(()=>[d("# "+C(a.id),1)]),_:2},1024),n(s(f).Item,{label:"\u6267\u884C\u6B21\u6570"},{default:u(()=>[d(C(a.limit>0?`\u4EC5 ${a.limit} \u6B21`:"\u65E0\u6B21\u6570\u9650\u5236"),1)]),_:2},1024),a.type===1?(T(),g(s(f).Item,{key:0,label:"\u6267\u884C\u95F4\u9694"},{default:u(()=>[d(" \u6BCF"+C(a.every)+"\u6BEB\u79D2\u6267\u884C\u4E00\u6B21 ",1)]),_:2},1024)):(T(),g(s(f).Item,{key:1,label:"Cron\u8868\u8FBE\u5F0F"},{default:u(()=>[n(s(j),null,{title:u(()=>[me]),default:u(()=>[d(" "+C(a.cron),1)]),_:2},1024)]),_:2},1024)),a.type===0?(T(),g(s(f).Item,{key:2,label:"\u6267\u884C\u65F6\u95F4\u6BB5"},{default:u(()=>[K("span",null,C(h(a)),1)]),_:2},1024)):L("",!0),n(s(f).Item,{label:"\u6267\u884C\u64CD\u4F5C"},{default:u(()=>[n(s(D),{title:"\u786E\u8BA4\u624B\u52A8\u6267\u884C\u4E00\u6B21\u8BE5\u4EFB\u52A1\u5417?",disabled:!t.$auth("sys.task.once"),onConfirm:y=>w(a)},{default:u(()=>[n(s(v),{type:"link",size:"small",disabled:!t.$auth("sys.task.once")},{icon:u(()=>[n(s(Q))]),default:u(()=>[pe]),_:1},8,["disabled"])]),_:2},1032,["disabled","onConfirm"]),n(s(D),{title:"\u786E\u8BA4\u8FD0\u884C\u8BE5\u4EFB\u52A1\u5417?",disabled:!t.$auth("sys.task.start")||a.status!==0,onConfirm:y=>b(a)},{default:u(()=>[n(s(v),{type:"link",size:"small",disabled:!t.$auth("sys.task.start")||a.status!==0},{icon:u(()=>[n(s(U))]),default:u(()=>[ce]),_:2},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"]),n(s(D),{title:"\u786E\u8BA4\u505C\u6B62\u8BE5\u4EFB\u52A1\u5417?",disabled:!t.$auth("sys.task.stop")||a.status!==1,onConfirm:y=>i(a)},{default:u(()=>[n(s(v),{type:"link",size:"small",disabled:!t.$auth("sys.task.stop")||a.status!==1},{icon:u(()=>[n(s(H))]),default:u(()=>[fe]),_:2},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-request"])])}}}));export{Te as default};
