!function(){var e=document.createElement("style");e.innerHTML=".split-wrapper{display:flex;width:100%;height:100%;background-color:#fff}.split-wrapper .scalable{position:relative;width:240px;max-width:50vw;min-width:100px;overflow:auto}.split-wrapper .scalable .left-content{height:100%;padding:12px 20px 12px 12px}.split-wrapper .scalable .separator{position:absolute;top:0;right:0;display:flex;width:14px;height:100%;cursor:col-resize;background-color:#fff;box-shadow:-4px -2px 4px -5px #00000059,4px 3px 4px -5px #00000059;align-items:center;justify-content:center}.split-wrapper .scalable .separator i{width:1px;height:14px;margin:0 1px;background-color:#e9e9e9}.split-wrapper .right-content{flex:1}.split-wrapper .left-content,.split-wrapper .right-content{overflow:auto}\n",document.head.appendChild(e),System.register(["./vendor-legacy.26c4b3e7.js","./index-legacy.f25f109a3.js","./index-legacy.864ddc88.js","./dynamic-table-legacy.4c5346be.js","./index-legacy.32405bce.js","./useFormModal-legacy.58a3c5b6.js","./utils-legacy.76523550.js"],(function(e){"use strict";var t,a,l,n,d,o,s,r,i,c,u,p,m,f,y,h,v,b,w,g,x,I,k,P,C,S,K,T,_,E,j,q,R,$,N,D,F,M,L,O,V,W,A,X,B,G;return{setters:[function(e){t=e.D,a=e.X,l=e.bu,n=e.bE,d=e.ap,o=e.b,s=e.j,r=e.au,i=e.o,c=e.e,u=e.f,p=e.a8,m=e.h,f=e.q,y=e.u,h=e.C,v=e.G,b=e.E,w=e.Q,g=e.aK,x=e.bK,I=e.I,k=e.bL,P=e.aW,C=e.ac,S=e.bM,K=e.bN,T=e.t,_=e.aB,E=e.a5,j=e.bt,q=e.bO,R=e.M,$=e.bP},function(){},function(e){N=e.g,D=e.u,F=e.c,M=e.t,L=e.d,O=e.a},function(e){V=e.D},function(e){W=e.y,A=e.B},function(e){X=e.u},function(e){B=e.f,G=e.a}],execute:function(){const U=[{field:"name",component:"Input",label:"部门名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}}],z=[{field:"departmentId",component:"TreeSelect",label:"所属部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"所属角色",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:async()=>(await N()).map((e=>({label:e.name,value:e.id})))}},{field:"username",component:"Input",label:"用户名",rules:[{required:!0}]},{field:"name",component:"Input",label:"姓名",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"呢称",colProps:{span:12}},{field:"email",component:"Input",label:"邮箱",colProps:{span:12}},{field:"phone",component:"Input",label:"手机",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",label:"状态",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],H=[{field:"password",component:"Input",label:"新密码",rules:[{required:!0,type:"string"}]}],Q=[{field:"departmentId",component:"TreeSelect",label:"转移至",rules:[{required:!0,type:"number"}]}];function J(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!n(e)}const Y=[{title:"头像",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:e})=>t(a,{src:e.headImg},null)},{title:"姓名",width:120,dataIndex:"name",align:"center"},{title:"用户名",width:120,align:"center",dataIndex:"username"},{title:"所在部门",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"所属角色",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,bodyCell:({record:e})=>{let a;return t(d,null,J(a=e.roleNames.map((e=>t(l,{color:"success",key:e},J(e)?e:{default:()=>[e]}))))?a:{default:()=>[a]})}},{title:"呢称",width:120,align:"center",dataIndex:"nickName"},{title:"邮箱",width:120,align:"center",dataIndex:"email"},{title:"手机",width:120,align:"center",dataIndex:"phone"},{title:"备注",width:120,align:"center",dataIndex:"remark"},{title:"状态",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},bodyCell:({record:e})=>{const a=1===e.status;return t(l,{color:a?"success":"red"},{default:()=>[a?"启用":"禁用"]})}}];const Z={class:"split-wrapper"},ee={class:"left-content"},te=m(" 右边内容区 "),ae=[u("i",null,null,-1),u("i",null,null,-1)],le={class:"right-content"},ne=m(" 右边内容区 ");var de=o({setup(e){const t=s();let a,l;const n=r((function(e){t.value&&(t.value.style.width=l+e.clientX-a+"px")}),20),d=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",n),document.documentElement.removeEventListener("mouseup",d)},o=e=>{a=e.clientX,t.value&&(l=parseInt(window.getComputedStyle(t.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",n),document.documentElement.addEventListener("mouseup",d)};return(e,a)=>(i(),c("div",Z,[u("div",{ref_key:"scalable",ref:t,class:"scalable"},[u("div",ee,[p(e.$slots,"left-content",{},(()=>[te]))]),u("div",{ref:"separator",class:"separator",onMousedown:o},ae,544)],512),u("div",le,[p(e.$slots,"right-content",{},(()=>[ne]))])]))}});function oe(e){return W({url:A.add,method:"post",data:e},{successMsg:"创建用户成功"})}function se(e){return W({url:A.update,method:"post",data:e},{successMsg:"修改用户成功"})}function re(e){return W({url:A.delete,method:"post",data:e})}const ie={class:"flex justify-between"},ce=u("div",null,"组织架构",-1),ue=m("新增部门 "),pe=m("刷新 "),me=m(" 编辑 "),fe=m(" 删除 "),ye=m("取消选择"),he=m(" 新增 "),ve=m(" 转移 "),be=m(" 删除 ");e("default",o({name:"SystemUser",setup(e){const[a]=X(),l=s(!1),n=s(),o=f({expandedKeys:[],departmentIds:[],deptTree:[]}),r=s({selectedRowKeys:[],onChange:(e,t)=>{console.log(`selectedRowKeys: ${e}`,"selectedRows: ",t),r.value.selectedRowKeys=e}}),c=y((()=>r.value.selectedRowKeys.length)),p=async(e={})=>{var t,l,n;console.log("record",e);const[d]=await a({modalProps:{title:(e.id?"编辑":"新增")+"部门",width:700,onFinish:async t=>{console.log("新增/编辑部门",t),t.id=e.id,await(e.id?D:F)(t),ee()}},formSchema:{labelWidth:100,layout:"vertical",schemas:U}});null===(t=d.value)||void 0===t||t.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((null==e?void 0:e.keyPath)||[]),treeData:[{value:-1,title:"#",children:o.deptTree}]}}]),null===(l=d.value)||void 0===l||l.setFieldsValue({...e,parentId:null!==(n=e.parentId)&&void 0!==n?n:-1})},N=async()=>{var e;const[t]=await a({modalProps:{title:"转移部门",width:700,onFinish:async e=>{await M({departmentId:e.departmentId,userIds:r.value.selectedRowKeys.map((e=>e))})}},formSchema:{labelWidth:100,layout:"vertical",schemas:Q}});null===(e=t.value)||void 0===e||e.updateSchema([{field:"departmentId",componentProps:{treeData:o.deptTree}}])},J=async(e={})=>{var t,l,d;const[s]=await a({modalProps:{title:(e.id?"编辑":"新增")+"用户",width:700,onFinish:async t=>{var a;console.log("新增/编辑用户",t),t.id=e.id,await(e.id?se:oe)(t),null===(a=n.value)||void 0===a||a.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:z}});if(null===(t=s.value)||void 0===t||t.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:(null===(l=B(null==e?void 0:e.departmentId,o.deptTree))||void 0===l?void 0:l.keyPath)||[],treeData:o.deptTree}}]),null===(d=s.value)||void 0===d||d.setFieldsValue(e),null!=e&&e.id){var r;const{roles:t}=await(i={userId:e.id},W({url:A.info,method:"get",params:i}));null===(r=s.value)||void 0===r||r.setFieldsValue({roles:t})}var i},Z=async e=>{await a({modalProps:{title:`修改密码(${e.username})`,width:700,onFinish:async t=>{var a;await(a={userId:e.id,password:t.password},W({url:A.password,method:"post",data:a},{successMsg:"操作成功"}))}},formSchema:{labelWidth:100,layout:"vertical",schemas:H}})},ee=async()=>{l.value=!0;const e=await O().finally((()=>l.value=!1));o.deptTree=G(e),o.expandedKeys=[...o.expandedKeys,...o.deptTree.map((e=>Number(e.key)))]};ee();const te=async e=>{var a;Array.isArray(e)?R.confirm({title:"确定要删除所选的用户吗?",icon:t($,null,null),centered:!0,onOk:async()=>{await re({userIds:e}),ee()}}):await re({userIds:[e]}).finally(null===(a=n.value)||void 0===a?void 0:a.refreshTable)},ae=e=>{var t,a;o.departmentIds=e,null==n||null===(t=n.value)||void 0===t||null===(a=t.refreshTable)||void 0===a||a.call(t)},le=async({page:e,limit:t})=>{const a=await function(e){return W({url:A.page,method:"post",data:e})}({page:e,limit:t,departmentIds:o.departmentIds.length?o.departmentIds:void 0});return r.value.selectedRowKeys=[],a},ne=[...Y,{title:"操作",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>J(e)},{label:"改密",auth:"sys.user.password",onClick:()=>Z(e)},{label:"删除",auth:"sys.user.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>te(e.id)}}]}];return(e,a)=>{const s=h("a-button");return i(),v(w(de),null,{"left-content":b((()=>[u("div",ie,[ce,t(w(d),null,{default:b((()=>[e.$auth("sys.dept.add")?(i(),v(w(g),{key:0,placement:"top"},{title:b((()=>[ue])),default:b((()=>[t(w(x),{onClick:a[0]||(a[0]=e=>p({}))})])),_:1})):I("",!0),t(w(g),{placement:"top"},{title:b((()=>[pe])),default:b((()=>[t(w(k),{spin:l.value,onClick:ee},null,8,["spin"])])),_:1})])),_:1})]),t(w(_),{expandedKeys:w(o).expandedKeys,"onUpdate:expandedKeys":a[1]||(a[1]=e=>w(o).expandedKeys=e),autoExpandParent:"","tree-data":w(o).deptTree,onSelect:ae},{title:b((({key:a,title:l,formData:n})=>[t(w(P),{trigger:["contextmenu"]},{overlay:b((()=>[t(w(C),null,{default:b((()=>[t(w(C).Item,{key:"1",disabled:!e.$auth("sys.dept.update"),onClick:e=>p(n)},{default:b((()=>[me,t(w(S))])),_:2},1032,["disabled","onClick"]),t(w(C).Item,{key:"2",disabled:!e.$auth("sys.dept.delete"),onClick:e=>{return l=a,void R.confirm({title:"确定要删除该部门吗?",icon:t($,null,null),centered:!0,onOk:async()=>{await L({departmentId:l}),ee()}});var l}},{default:b((()=>[fe,t(w(K))])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),default:b((()=>[u("span",null,T(l),1)])),_:2},1024)])),_:1},8,["expandedKeys","tree-data"])])),"right-content":b((()=>[t(w(V),{ref_key:"dynamicTableRef",ref:n,"header-title":"用户管理","show-index":"",titleTooltip:"请不要随意删除用户，避免到影响其他用户的使用。","data-request":le,columns:ne,scroll:{x:2e3},"row-selection":r.value},E({toolbar:b((()=>[t(s,{type:"primary",disabled:!e.$auth("sys.user.add"),onClick:a[3]||(a[3]=e=>J({}))},{default:b((()=>[t(w(x)),he])),_:1},8,["disabled"]),t(s,{type:"success",disabled:!w(c)||!e.$auth("sys.dept.transfer"),onClick:N},{default:b((()=>[t(w(q)),ve])),_:1},8,["disabled"]),t(s,{type:"danger",disabled:!w(c)||!e.$auth("sys.user.delete"),onClick:a[4]||(a[4]=e=>te(r.value.selectedRowKeys))},{default:b((()=>[t(w(K)),be])),_:1},8,["disabled"])])),_:2},[w(c)?{name:"title",fn:b((()=>[t(w(j),{class:"w-full",type:"info","show-icon":""},{message:b((()=>[m(" 已选 "+T(w(c))+" 项 ",1),t(s,{type:"link",onClick:a[2]||(a[2]=e=>r.value.selectedRowKeys=[])},{default:b((()=>[ye])),_:1})])),_:1})]))}:void 0]),1032,["row-selection"])])),_:1})}}}))}}}))}();
