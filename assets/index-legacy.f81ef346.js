System.register(["./index-legacy.864ddc88.js","./index-legacy.3d270040.js","./dynamic-table-legacy.4c5346be.js","./useFormModal-legacy.58a3c5b6.js","./utils-legacy.76523550.js","./vendor-legacy.26c4b3e7.js","./index-legacy.32405bce.js"],(function(e){"use strict";var a,l,t,n,d,o,i,r,s,c,u,p,m,h,f,b,y,v,g,I;return{setters:[function(e){a=e.b,l=e.e,t=e.f,n=e.a,d=e.h,o=e.i},function(e){i=e.g},function(e){r=e.D},function(e){s=e.u},function(e){c=e.b,u=e.a},function(e){p=e.b,m=e.j,h=e.C,f=e.o,b=e.e,y=e.D,v=e.E,g=e.Q,I=e.h},function(){}],execute:function(){const x=[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"名称",width:200,align:"center",dataIndex:"name"},{title:"标识",width:80,align:"center",dataIndex:"label"},{title:"备注",dataIndex:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"更新时间",align:"center",dataIndex:"updatedAt",hideInSearch:!0}],k=[{field:"name",component:"Input",label:"名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"标识",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menus",component:"Tree",label:"菜单权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"部门权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],w=I(" 新增 ");e("default",p({name:"SystemPermissionRole",setup(e){const p=m(),[I]=s(),P=(e,a,l=[])=>a.reduce(((a,t)=>{var n;return null!==(n=t.children)&&void 0!==n&&n.length?P(e,t.children,l):e.includes(t.value)&&a.push(t.value),a}),l),j=async e=>{var a;const[o]=await I({modalProps:{title:(e.id?"编辑":"新增")+"角色",width:"50%",onFinish:async a=>{var n,d,i,r,s;e.id&&(a.roleId=e.id);const c=null===(n=o.value)||void 0===n||null===(d=n.compRefs)||void 0===d?void 0:d.menus,u=null===(i=o.value)||void 0===i||null===(r=i.compRefs)||void 0===r?void 0:r.depts,m={...a,menus:[...c.halfCheckedKeys,...c.checkedKeys],depts:[...u.halfCheckedKeys,...u.checkedKeys]};console.log("新增/编辑角色",m),await(e.id?l:t)(m),null===(s=p.value)||void 0===s||s.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:k}}),[r,s]=await Promise.all([n(),i()]),m=c(s),h=u(r);if(null===(a=o.value)||void 0===a||a.updateSchema([{field:"menus",componentProps:{treeData:m}},{field:"depts",componentProps:{treeData:h}}]),e.id){var f;const a=await d({roleId:e.id}),l=a.menus.map((e=>e.menuId)),t=a.depts.map((e=>e.departmentId));null===(f=o.value)||void 0===f||f.setFieldsValue({...e,name:a.roleInfo.name,label:a.roleInfo.label,remark:a.roleInfo.remark,menus:P(l,m),depts:P(t,h)})}},K=[...x,{title:"操作",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.role.update",effect:"disable"},onClick:()=>j(e)},{label:"删除",auth:"sys.role.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>(async e=>{var a;await o({roleIds:[e.id]}),null===(a=p.value)||void 0===a||a.refreshTable()})(e)}}]}];return(e,l)=>{const t=h("a-button");return f(),b("div",null,[y(g(r),{ref_key:"dynamicTableRef",ref:p,"row-key":"id","header-title":"角色管理","data-request":g(a),columns:K,bordered:"",size:"small"},{toolbar:v((()=>[y(t,{type:"primary",disabled:!e.$auth("sys.role.add"),onClick:l[0]||(l[0]=e=>j({}))},{default:v((()=>[w])),_:1},8,["disabled"])])),_:1},8,["data-request"])])}}}))}}}));
