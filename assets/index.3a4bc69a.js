var E=Object.defineProperty,K=Object.defineProperties;var M=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var _=(n,a,o)=>a in n?E(n,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[a]=o,h=(n,a)=>{for(var o in a||(a={}))S.call(a,o)&&_(n,o,a[o]);if(T)for(var o of T(a))A.call(a,o)&&_(n,o,a[o]);return n},b=(n,a)=>K(n,M(a));var y=(n,a,o)=>new Promise((u,i)=>{var I=t=>{try{e(o.next(t))}catch(s){i(s)}},g=t=>{try{e(o.throw(t))}catch(s){i(s)}},e=t=>t.done?u(t.value):Promise.resolve(t.value).then(I,g);e((o=o.apply(n,a)).next())});import{b as q,e as $,f as V,a as L,h as N,i as j}from"./index.2dc20178.js";import{g as z}from"./index.8d283df4.js";import{D as Q}from"./dynamic-table.96d276c6.js";import{u as W}from"./useFormModal.67d087a2.js";import{b as G,a as H}from"./utils.1ab06744.js";import{b as J,j as O,C as U,o as X,e as Y,D as v,E as P,Q as B,h as Z}from"./vendor.1de287a7.js";import"./index.57f23076.js";const ee=[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"\u540D\u79F0",width:200,align:"center",dataIndex:"name"},{title:"\u6807\u8BC6",width:80,align:"center",dataIndex:"label"},{title:"\u5907\u6CE8",dataIndex:"remark",align:"center"},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"\u66F4\u65B0\u65F6\u95F4",align:"center",dataIndex:"updatedAt",hideInSearch:!0}],te=[{field:"name",component:"Input",label:"\u540D\u79F0",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"\u6807\u8BC6",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"menus",component:"Tree",label:"\u83DC\u5355\u6743\u9650",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"\u90E8\u95E8\u6743\u9650",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],ae=Z(" \u65B0\u589E "),oe={name:"SystemPermissionRole"},pe=J(b(h({},oe),{setup(n){const a=O(),[o]=W(),u=(e,t,s=[])=>t.reduce((c,d)=>{var p;return(p=d.children)!=null&&p.length?u(e,d.children,s):e.includes(d.value)&&c.push(d.value),c},s),i=e=>y(this,null,function*(){var x,k;const[t]=yield o({modalProps:{title:`${e.id?"\u7F16\u8F91":"\u65B0\u589E"}\u89D2\u8272`,width:"50%",onFinish:l=>y(this,null,function*(){var C,w,R,D,F;e.id&&(l.roleId=e.id);const m=(w=(C=t.value)==null?void 0:C.compRefs)==null?void 0:w.menus,f=(D=(R=t.value)==null?void 0:R.compRefs)==null?void 0:D.depts,r=b(h({},l),{menus:[...m.halfCheckedKeys,...m.checkedKeys],depts:[...f.halfCheckedKeys,...f.checkedKeys]});yield(e.id?$:V)(r),(F=a.value)==null||F.refreshTable()})},formSchema:{labelWidth:100,layout:"vertical",schemas:te}}),[s,c]=yield Promise.all([L(),z()]),d=G(c),p=H(s);if((x=t.value)==null||x.updateSchema([{field:"menus",componentProps:{treeData:d}},{field:"depts",componentProps:{treeData:p}}]),e.id){const l=yield N({roleId:e.id}),m=l.menus.map(r=>r.menuId),f=l.depts.map(r=>r.departmentId);(k=t.value)==null||k.setFieldsValue(b(h({},e),{name:l.roleInfo.name,label:l.roleInfo.label,remark:l.roleInfo.remark,menus:u(m,d),depts:u(f,p)}))}}),I=e=>y(this,null,function*(){var t;yield j({roleIds:[e.id]}),(t=a.value)==null||t.refreshTable()}),g=[...ee,{title:"\u64CD\u4F5C",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.role.update",effect:"disable"},onClick:()=>i(e)},{label:"\u5220\u9664",auth:"sys.role.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>I(e)}}]}];return(e,t)=>{const s=U("a-button");return X(),Y("div",null,[v(B(Q),{ref_key:"dynamicTableRef",ref:a,"row-key":"id","header-title":"\u89D2\u8272\u7BA1\u7406","data-request":B(q),columns:g,bordered:"",size:"small"},{toolbar:P(()=>[v(s,{type:"primary",disabled:!e.$auth("sys.role.add"),onClick:t[0]||(t[0]=c=>i({}))},{default:P(()=>[ae]),_:1},8,["disabled"])]),_:1},8,["data-request"])])}}}));export{pe as default};
