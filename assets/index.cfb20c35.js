var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var R=(t,a,s)=>a in t?ee(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,x=(t,a)=>{for(var s in a||(a={}))ne.call(a,s)&&R(t,s,a[s]);if(K)for(var s of K(a))se.call(a,s)&&R(t,s,a[s]);return t},D=(t,a)=>te(t,ae(a));var c=(t,a,s)=>new Promise((f,d)=>{var m=y=>{try{p(s.next(y))}catch(g){d(g)}},w=y=>{try{p(s.throw(y))}catch(g){d(g)}},p=y=>y.done?f(y.value):Promise.resolve(y.value).then(m,w);p((s=s.apply(t,a)).next())});import{D as l,X as le,bu as M,bE as oe,ap as G,b as Q,j as P,au as de,o as F,e as ue,f as b,a8 as N,h,q as ie,u as re,C as ce,G as U,E as u,Q as o,aK as q,bK as A,I as pe,bL as me,aW as fe,ac as $,bM as he,bN as L,t as O,aB as ye,a5 as be,bt as we,bO as _e,M as V,bP as W}from"./vendor.1de287a7.js";/* empty css               */import{g as ve,u as Ie,c as ge,t as Ce,d as Ee,a as Se}from"./index.2dc20178.js";import{D as ke}from"./dynamic-table.96d276c6.js";import{y as C,B as E}from"./index.57f23076.js";import{u as Pe}from"./useFormModal.67d087a2.js";import{f as xe,a as De}from"./utils.1ab06744.js";const $e=[{field:"name",component:"Input",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"\u4E0A\u7EA7\u90E8\u95E8",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"\u6392\u5E8F\u53F7",defaultValue:255,componentProps:{style:{width:"100%"}}}],Fe=[{field:"departmentId",component:"TreeSelect",label:"\u6240\u5C5E\u90E8\u95E8",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"\u6240\u5C5E\u89D2\u8272",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:()=>c(void 0,null,function*(){return(yield ve()).map(a=>({label:a.name,value:a.id}))})}},{field:"username",component:"Input",label:"\u7528\u6237\u540D",rules:[{required:!0}]},{field:"name",component:"Input",label:"\u59D3\u540D",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"\u5462\u79F0",colProps:{span:12}},{field:"email",component:"Input",label:"\u90AE\u7BB1",colProps:{span:12}},{field:"phone",component:"Input",label:"\u624B\u673A",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"status",component:"RadioGroup",label:"\u72B6\u6001",defaultValue:1,componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}}],Te=[{field:"password",component:"Input",label:"\u65B0\u5BC6\u7801",rules:[{required:!0,type:"string"}]}],Be=[{field:"departmentId",component:"TreeSelect",label:"\u8F6C\u79FB\u81F3",rules:[{required:!0,type:"number"}]}];function j(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!oe(t)}const Ke=[{title:"\u5934\u50CF",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:t})=>l(le,{src:t.headImg},null)},{title:"\u59D3\u540D",width:120,dataIndex:"name",align:"center"},{title:"\u7528\u6237\u540D",width:120,align:"center",dataIndex:"username"},{title:"\u6240\u5728\u90E8\u95E8",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"\u6240\u5C5E\u89D2\u8272",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,bodyCell:({record:t})=>{let a;return l(G,null,j(a=t.roleNames.map(s=>l(M,{color:"success",key:s},j(s)?s:{default:()=>[s]})))?a:{default:()=>[a]})}},{title:"\u5462\u79F0",width:120,align:"center",dataIndex:"nickName"},{title:"\u90AE\u7BB1",width:120,align:"center",dataIndex:"email"},{title:"\u624B\u673A",width:120,align:"center",dataIndex:"phone"},{title:"\u5907\u6CE8",width:120,align:"center",dataIndex:"remark"},{title:"\u72B6\u6001",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}},bodyCell:({record:t})=>{const a=t.status===1;return l(M,{color:a?"success":"red"},{default:()=>[a?"\u542F\u7528":"\u7981\u7528"]})}}];const Re={class:"split-wrapper"},Me={class:"left-content"},Ne=h(" \u53F3\u8FB9\u5185\u5BB9\u533A "),Ue=b("i",null,null,-1),qe=b("i",null,null,-1),Ae=[Ue,qe],Le={class:"right-content"},Oe=h(" \u53F3\u8FB9\u5185\u5BB9\u533A "),Ve=Q({setup(t){const a=P();let s,f;const d=de(function(p){a.value&&(a.value.style.width=f+p.clientX-s+"px")},20),m=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",d),document.documentElement.removeEventListener("mouseup",m)},w=p=>{s=p.clientX,a.value&&(f=parseInt(window.getComputedStyle(a.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",d),document.documentElement.addEventListener("mouseup",m)};return(p,y)=>(F(),ue("div",Re,[b("div",{ref_key:"scalable",ref:a,class:"scalable"},[b("div",Me,[N(p.$slots,"left-content",{},()=>[Ne])]),b("div",{ref:"separator",class:"separator",onMousedown:w},Ae,544)],512),b("div",Le,[N(p.$slots,"right-content",{},()=>[Oe])])]))}});var We=Ve;function je(t){return C({url:E.page,method:"post",data:t})}function Xe(t){return C({url:E.add,method:"post",data:t},{successMsg:"\u521B\u5EFA\u7528\u6237\u6210\u529F"})}function Ge(t){return C({url:E.info,method:"get",params:t})}function Qe(t){return C({url:E.update,method:"post",data:t},{successMsg:"\u4FEE\u6539\u7528\u6237\u6210\u529F"})}function ze(t){return C({url:E.password,method:"post",data:t},{successMsg:"\u64CD\u4F5C\u6210\u529F"})}function X(t){return C({url:E.delete,method:"post",data:t})}const He={class:"flex justify-between"},Je=b("div",null,"\u7EC4\u7EC7\u67B6\u6784",-1),Ye=h("\u65B0\u589E\u90E8\u95E8 "),Ze=h("\u5237\u65B0 "),et=h(" \u7F16\u8F91 "),tt=h(" \u5220\u9664 "),at=h("\u53D6\u6D88\u9009\u62E9"),nt=h(" \u65B0\u589E "),st=h(" \u8F6C\u79FB "),lt=h(" \u5220\u9664 "),ot={name:"SystemUser"};var ht=Q(D(x({},ot),{setup(t){const[a]=Pe(),s=P(!1),f=P(),d=ie({expandedKeys:[],departmentIds:[],deptTree:[]}),m=P({selectedRowKeys:[],onChange:(e,n)=>{`${e}`,m.value.selectedRowKeys=e}}),w=re(()=>m.value.selectedRowKeys.length),p=(...n)=>c(this,[...n],function*(e={}){var i,v,I;const[r]=yield a({modalProps:{title:`${e.id?"\u7F16\u8F91":"\u65B0\u589E"}\u90E8\u95E8`,width:700,onFinish:_=>c(this,null,function*(){_.id=e.id,yield(e.id?Ie:ge)(_),S()})},formSchema:{labelWidth:100,layout:"vertical",schemas:$e}});(i=r.value)==null||i.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((e==null?void 0:e.keyPath)||[]),treeData:[{value:-1,title:"#",children:d.deptTree}]}}]),(I=r.value)==null||I.setFieldsValue(D(x({},e),{parentId:(v=e.parentId)!=null?v:-1}))}),y=()=>c(this,null,function*(){var n;const[e]=yield a({modalProps:{title:"\u8F6C\u79FB\u90E8\u95E8",width:700,onFinish:r=>c(this,null,function*(){yield Ce({departmentId:r.departmentId,userIds:m.value.selectedRowKeys.map(i=>i)})})},formSchema:{labelWidth:100,layout:"vertical",schemas:Be}});(n=e.value)==null||n.updateSchema([{field:"departmentId",componentProps:{treeData:d.deptTree}}])}),g=(...n)=>c(this,[...n],function*(e={}){var i,v,I,_;const[r]=yield a({modalProps:{title:`${e.id?"\u7F16\u8F91":"\u65B0\u589E"}\u7528\u6237`,width:700,onFinish:k=>c(this,null,function*(){var B;k.id=e.id,yield(e.id?Qe:Xe)(k),(B=f.value)==null||B.refreshTable()})},formSchema:{labelWidth:100,layout:"vertical",schemas:Fe}});if((v=r.value)==null||v.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:((i=xe(e==null?void 0:e.departmentId,d.deptTree))==null?void 0:i.keyPath)||[],treeData:d.deptTree}}]),(I=r.value)==null||I.setFieldsValue(e),e!=null&&e.id){const{roles:k}=yield Ge({userId:e.id});(_=r.value)==null||_.setFieldsValue({roles:k})}}),z=e=>c(this,null,function*(){yield a({modalProps:{title:`\u4FEE\u6539\u5BC6\u7801(${e.username})`,width:700,onFinish:n=>c(this,null,function*(){yield ze({userId:e.id,password:n.password})})},formSchema:{labelWidth:100,layout:"vertical",schemas:Te}})}),H=e=>{V.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u90E8\u95E8\u5417?",icon:l(W,null,null),centered:!0,onOk:()=>c(this,null,function*(){yield Ee({departmentId:e}),S()})})},S=()=>c(this,null,function*(){s.value=!0;const e=yield Se().finally(()=>s.value=!1);d.deptTree=De(e),d.expandedKeys=[...d.expandedKeys,...d.deptTree.map(n=>Number(n.key))]});S();const T=e=>c(this,null,function*(){var n;Array.isArray(e)?V.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u6240\u9009\u7684\u7528\u6237\u5417?",icon:l(W,null,null),centered:!0,onOk:()=>c(this,null,function*(){yield X({userIds:e}),S()})}):yield X({userIds:[e]}).finally((n=f.value)==null?void 0:n.refreshTable)}),J=e=>{var n,r;d.departmentIds=e,(r=(n=f==null?void 0:f.value)==null?void 0:n.refreshTable)==null||r.call(n)},Y=r=>c(this,[r],function*({page:e,limit:n}){const i=yield je({page:e,limit:n,departmentIds:d.departmentIds.length?d.departmentIds:void 0});return m.value.selectedRowKeys=[],i}),Z=[...Ke,{title:"\u64CD\u4F5C",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>g(e)},{label:"\u6539\u5BC6",auth:"sys.user.password",onClick:()=>z(e)},{label:"\u5220\u9664",auth:"sys.user.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>T(e.id)}}]}];return(e,n)=>{const r=ce("a-button");return F(),U(o(We),null,{"left-content":u(()=>[b("div",He,[Je,l(o(G),null,{default:u(()=>[e.$auth("sys.dept.add")?(F(),U(o(q),{key:0,placement:"top"},{title:u(()=>[Ye]),default:u(()=>[l(o(A),{onClick:n[0]||(n[0]=i=>p({}))})]),_:1})):pe("",!0),l(o(q),{placement:"top"},{title:u(()=>[Ze]),default:u(()=>[l(o(me),{spin:s.value,onClick:S},null,8,["spin"])]),_:1})]),_:1})]),l(o(ye),{expandedKeys:o(d).expandedKeys,"onUpdate:expandedKeys":n[1]||(n[1]=i=>o(d).expandedKeys=i),autoExpandParent:"","tree-data":o(d).deptTree,onSelect:J},{title:u(({key:i,title:v,formData:I})=>[l(o(fe),{trigger:["contextmenu"]},{overlay:u(()=>[l(o($),null,{default:u(()=>[l(o($).Item,{key:"1",disabled:!e.$auth("sys.dept.update"),onClick:_=>p(I)},{default:u(()=>[et,l(o(he))]),_:2},1032,["disabled","onClick"]),l(o($).Item,{key:"2",disabled:!e.$auth("sys.dept.delete"),onClick:_=>H(i)},{default:u(()=>[tt,l(o(L))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:u(()=>[b("span",null,O(v),1)]),_:2},1024)]),_:1},8,["expandedKeys","tree-data"])]),"right-content":u(()=>[l(o(ke),{ref_key:"dynamicTableRef",ref:f,"header-title":"\u7528\u6237\u7BA1\u7406","show-index":"",titleTooltip:"\u8BF7\u4E0D\u8981\u968F\u610F\u5220\u9664\u7528\u6237\uFF0C\u907F\u514D\u5230\u5F71\u54CD\u5176\u4ED6\u7528\u6237\u7684\u4F7F\u7528\u3002","data-request":Y,columns:Z,scroll:{x:2e3},"row-selection":m.value},be({toolbar:u(()=>[l(r,{type:"primary",disabled:!e.$auth("sys.user.add"),onClick:n[3]||(n[3]=i=>g({}))},{default:u(()=>[l(o(A)),nt]),_:1},8,["disabled"]),l(r,{type:"success",disabled:!o(w)||!e.$auth("sys.dept.transfer"),onClick:y},{default:u(()=>[l(o(_e)),st]),_:1},8,["disabled"]),l(r,{type:"danger",disabled:!o(w)||!e.$auth("sys.user.delete"),onClick:n[4]||(n[4]=i=>T(m.value.selectedRowKeys))},{default:u(()=>[l(o(L)),lt]),_:1},8,["disabled"])]),_:2},[o(w)?{name:"title",fn:u(()=>[l(o(we),{class:"w-full",type:"info","show-icon":""},{message:u(()=>[h(" \u5DF2\u9009 "+O(o(w))+" \u9879 ",1),l(r,{type:"link",onClick:n[2]||(n[2]=i=>m.value.selectedRowKeys=[])},{default:u(()=>[at]),_:1})]),_:1})])}:void 0]),1032,["row-selection"])]),_:1})}}}));export{ht as default};
