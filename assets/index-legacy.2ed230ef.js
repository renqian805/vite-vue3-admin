System.register(["./vendor-legacy.26c4b3e7.js","./index-legacy.f25f109a.js","./dynamic-table-legacy.4c5346be.js","./index-legacy.f25f109a2.js","./useFormModal-legacy.58a3c5b6.js","./index-legacy.32405bce.js"],(function(e){"use strict";var t,a,l,n,d,i,s,o,r,u,c,m,p,f,b,y,h,v,I,w,g,k,C,T,_,x;return{setters:[function(e){t=e.D,a=e.bs,l=e.bu,n=e.b,d=e.j,i=e.C,s=e.o,o=e.e,r=e.E,u=e.Q,c=e.br,m=e.h,p=e.t,f=e.G,b=e.aK,y=e.f,h=e.I,v=e.bw,I=e.a7,w=e.bV,g=e.bW,k=e.bh},function(){},function(e){C=e.D},function(){},function(e){T=e.u},function(e){_=e.y,x=e.O}],execute:function(){const $=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},P=e=>{switch(e){case 0:return"停止";case 1:return"运行"}},j=[{title:"任务名称",dataIndex:"name",width:240},{title:"状态",width:120,dataIndex:"status",align:"center",bodyCell:({record:e})=>t(a,{status:1===e.status?"processing":"default",color:$(e.status),text:P(e.status)},null)},{title:"类型",width:100,align:"center",dataIndex:"type",bodyCell:({record:e})=>t(l,{color:"processing"},{default:()=>[1===e.type?"Interval":"Cron"]})},{title:"调用服务",dataIndex:"service",hideInSearch:!0,align:"center",width:350},{title:"执行参数",dataIndex:"data",align:"center",hideInSearch:!0,width:450},{title:"备注",width:250,align:"center",dataIndex:"remark"}],q=[{field:"type",component:"RadioGroup",label:"名称",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"时间间隔",value:1}]}},{field:"name",component:"Input",label:"任务名称",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"服务路径",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"请输入调用服务的路径"}},{field:"data",component:"Input",label:"任务参数",componentProps:{placeholder:"请输入任务参数（可不填）"}},{field:"limit",component:"InputNumber",label:"执行次数",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>0===e.type,componentProps:{placeholder:"请输入Cron表达式"}},{field:"every",component:"InputNumber",label:"执行间隔",defaultValue:6e4,vIf:({formModel:e})=>1===e.type,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"开始时间",vIf:({formModel:e})=>0===e.type,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"结束时间",vIf:({formModel:e})=>0===e.type,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",defaultValue:1,label:"状态",componentProps:{options:[{label:"运行",value:1},{label:"停止",value:0}]}}];function M(e){return _({url:x.page,method:"get",params:e})}function S(e){return _({url:x.add,method:"post",data:e},{successMsg:"添加成功"})}function V(e){return _({url:x.update,method:"post",data:e},{successMsg:"修改成功"})}const R=m(" 新增 "),z=m("秒 分 小时 日期 月份 星期 年(可选)"),D=m("仅一次 "),F=m("运行 "),G=m("停止 ");e("default",n({name:"SystemScheduleTask",setup(e){const a=d(),[l]=T(),n=()=>{var e;return null===(e=a.value)||void 0===e?void 0:e.refreshTable()},$=async e=>{const[t]=await l({modalProps:{title:(e.id?"编辑":"新增")+"任务",width:640,onFinish:async t=>{const a={...t,id:e.id};console.log("新增/编辑任务",a),await(e.id?V:S)(a),n()}},formSchema:{labelWidth:100,layout:"vertical",schemas:q}});if(e.id){var a;const l=await(d={id:e.id},_({url:x.info,method:"get",params:d}));null===(a=t.value)||void 0===a||a.setFieldsValue({...e,...l})}var d},P=async e=>{var t;await(t={id:e},_({url:x.delete,method:"post",data:t})),n()},N=async e=>{var t;await(t={id:e.id},_({url:x.once,method:"post",data:t})),n()},W=async e=>{var t;await(t={id:e.id},_({url:x.start,method:"post",data:t})),n()},A=async e=>{var t;await(t={id:e.id},_({url:x.stop,method:"post",data:t})),n()},E=e=>e.startTime||e.endTime?!e.startTime&&e.endTime?`无开始时间限制 - ${e.endTime}`:e.startTime&&!e.endTime?`${e.startTime} - 长期有效`:`${e.startTime} - ${e.endTime}`:"无时段限制",K=[...j,{title:"操作",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.task.update",effect:"disable"},onClick:()=>$(e)},{label:"删除",auth:"sys.task.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>P(e.id)}}]}];return(e,l)=>{const n=i("a-button");return s(),o("div",null,[t(u(C),{ref_key:"dynamicTableRef",ref:a,"row-key":"id","header-title":"定时任务",search:!1,"data-request":u(M),columns:K,scroll:{x:2e3},bordered:"",size:"small"},{toolbar:r((()=>[t(n,{type:"primary",disabled:!e.$auth("sys.task.add"),onClick:l[0]||(l[0]=e=>$({}))},{default:r((()=>[R])),_:1},8,["disabled"])])),expandedRowRender:r((({record:a})=>[t(u(c),{column:1},{default:r((()=>[t(u(c).Item,{label:"任务编号"},{default:r((()=>[m("# "+p(a.id),1)])),_:2},1024),t(u(c).Item,{label:"执行次数"},{default:r((()=>[m(p(a.limit>0?`仅 ${a.limit} 次`:"无次数限制"),1)])),_:2},1024),1===a.type?(s(),f(u(c).Item,{key:0,label:"执行间隔"},{default:r((()=>[m(" 每"+p(a.every)+"毫秒执行一次 ",1)])),_:2},1024)):(s(),f(u(c).Item,{key:1,label:"Cron表达式"},{default:r((()=>[t(u(b),null,{title:r((()=>[z])),default:r((()=>[m(" "+p(a.cron),1)])),_:2},1024)])),_:2},1024)),0===a.type?(s(),f(u(c).Item,{key:2,label:"执行时间段"},{default:r((()=>[y("span",null,p(E(a)),1)])),_:2},1024)):h("",!0),t(u(c).Item,{label:"执行操作"},{default:r((()=>[t(u(v),{title:"确认手动执行一次该任务吗?",disabled:!e.$auth("sys.task.once"),onConfirm:e=>N(a)},{default:r((()=>[t(u(I),{type:"link",size:"small",disabled:!e.$auth("sys.task.once")},{icon:r((()=>[t(u(w))])),default:r((()=>[D])),_:1},8,["disabled"])])),_:2},1032,["disabled","onConfirm"]),t(u(v),{title:"确认运行该任务吗?",disabled:!(e.$auth("sys.task.start")&&0===a.status),onConfirm:e=>W(a)},{default:r((()=>[t(u(I),{type:"link",size:"small",disabled:!(e.$auth("sys.task.start")&&0===a.status)},{icon:r((()=>[t(u(g))])),default:r((()=>[F])),_:2},1032,["disabled"])])),_:2},1032,["disabled","onConfirm"]),t(u(v),{title:"确认停止该任务吗?",disabled:!(e.$auth("sys.task.stop")&&1===a.status),onConfirm:e=>A(a)},{default:r((()=>[t(u(I),{type:"link",size:"small",disabled:!(e.$auth("sys.task.stop")&&1===a.status)},{icon:r((()=>[t(u(k))])),default:r((()=>[G])),_:2},1032,["disabled"])])),_:2},1032,["disabled","onConfirm"])])),_:2},1024)])),_:2},1024)])),_:1},8,["data-request"])])}}}))}}}));
